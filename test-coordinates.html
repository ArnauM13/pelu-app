<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Coordenades amb Pausa de Dinar</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Test Coordenades amb Pausa de Dinar</h1>

        <div class="test-section">
            <h3>Configuració</h3>
            <div>
                <label>Hora inici: <input type="number" id="businessStart" value="8" min="0" max="23"></label>
                <label>Hora fi: <input type="number" id="businessEnd" value="20" min="0" max="23"></label>
                <label>Pausa inici: <input type="number" id="lunchStart" value="13" min="0" max="23"></label>
                <label>Pausa fi: <input type="number" id="lunchEnd" value="15" min="0" max="23"></label>
                <label>Altura slot: <input type="number" id="slotHeight" value="30" min="10" max="100"></label>
                <label>Duració slot: <input type="number" id="slotDuration" value="30" min="15" max="60"></label>
            </div>
            <button onclick="updateConfig()">Actualitzar Configuració</button>
        </div>

        <div class="grid">
            <div class="test-section">
                <h3>Test: Coordenada → Temps</h3>
                <div>
                    <label>Coordenada Y: <input type="number" id="testY" value="300" min="0" max="1000"></label>
                    <button onclick="testCoordinateToTime()">Calcular Temps</button>
                </div>
                <div id="coordinateToTimeResult" class="test-result"></div>
            </div>

            <div class="test-section">
                <h3>Test: Temps → Coordenada</h3>
                <div>
                    <label>Temps: <input type="text" id="testTime" value="17:00" placeholder="HH:MM"></label>
                    <button onclick="testTimeToCoordinate()">Calcular Coordenada</button>
                </div>
                <div id="timeToCoordinateResult" class="test-result"></div>
            </div>
        </div>

        <div class="test-section">
            <h3>Test: Conversió Bidireccional</h3>
            <button onclick="testBidirectional()">Test Bidireccional</button>
            <div id="bidirectionalResult" class="test-result"></div>
        </div>

        <div class="test-section">
            <h3>Test: Hores Específiques</h3>
            <button onclick="testSpecificHours()">Test Hores Específiques</button>
            <div id="specificHoursResult" class="test-result"></div>
        </div>
    </div>

    <script>
        // Configuració per defecte
        let config = {
            businessStartHour: 8,
            businessEndHour: 20,
            lunchBreakStart: 13,
            lunchBreakEnd: 15,
            slotHeightPx: 30,
            slotDurationMinutes: 30
        };

        function updateConfig() {
            config = {
                businessStartHour: parseInt(document.getElementById('businessStart').value),
                businessEndHour: parseInt(document.getElementById('businessEnd').value),
                lunchBreakStart: parseInt(document.getElementById('lunchStart').value),
                lunchBreakEnd: parseInt(document.getElementById('lunchEnd').value),
                slotHeightPx: parseInt(document.getElementById('slotHeight').value),
                slotDurationMinutes: parseInt(document.getElementById('slotDuration').value)
            };
            console.log('Configuració actualitzada:', config);
        }

        // Mètode coordinateToTime (versió corregida)
        function coordinateToTime(yPosition) {
            const slotIndex = Math.round(yPosition / config.slotHeightPx);
            const totalMinutes = (config.businessStartHour * 60) + (slotIndex * config.slotDurationMinutes);

            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;

            const clampedHours = Math.max(config.businessStartHour, Math.min(config.businessEndHour - 1, hours));

            return `${clampedHours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        }

        // Mètode timeToCoordinate (versió corregida)
        function timeToCoordinate(time) {
            const [hours, minutes] = time.split(':').map(Number);
            const minutesSinceStart = (hours - config.businessStartHour) * 60 + minutes;
            const slotIndex = minutesSinceStart / config.slotDurationMinutes;
            return slotIndex * config.slotHeightPx;
        }

        function testCoordinateToTime() {
            const yPosition = parseInt(document.getElementById('testY').value);
            const result = coordinateToTime(yPosition);

            const slotIndex = Math.round(yPosition / config.slotHeightPx);
            const totalMinutes = (config.businessStartHour * 60) + (slotIndex * config.slotDurationMinutes);
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;

            document.getElementById('coordinateToTimeResult').innerHTML = `
                <div class="info">
                    <strong>Coordenada Y:</strong> ${yPosition}px<br>
                    <strong>Slot Index:</strong> ${slotIndex}<br>
                    <strong>Total Minuts:</strong> ${totalMinutes}<br>
                    <strong>Hores:</strong> ${hours}, <strong>Minuts:</strong> ${minutes}<br>
                    <strong>Resultat:</strong> ${result}
                </div>
            `;
        }

        function testTimeToCoordinate() {
            const time = document.getElementById('testTime').value;
            const result = timeToCoordinate(time);

            const [hours, minutes] = time.split(':').map(Number);
            const minutesSinceStart = (hours - config.businessStartHour) * 60 + minutes;
            const slotIndex = minutesSinceStart / config.slotDurationMinutes;

            document.getElementById('timeToCoordinateResult').innerHTML = `
                <div class="info">
                    <strong>Temps:</strong> ${time}<br>
                    <strong>Minuts des de inici:</strong> ${minutesSinceStart}<br>
                    <strong>Slot Index:</strong> ${slotIndex}<br>
                    <strong>Resultat:</strong> ${result}px
                </div>
            `;
        }

        function testBidirectional() {
            const testTimes = ['08:00', '10:30', '12:30', '13:00', '15:00', '17:00', '19:30'];
            let results = '<div class="info"><h4>Test Bidireccional:</h4>';

            testTimes.forEach(time => {
                const coordinate = timeToCoordinate(time);
                const backToTime = coordinateToTime(coordinate);
                const isCorrect = time === backToTime;

                results += `
                    <div class="${isCorrect ? 'success' : 'error'}">
                        <strong>${time}</strong> → ${coordinate}px → <strong>${backToTime}</strong>
                        ${isCorrect ? '✅' : '❌'}
                    </div>
                `;
            });

            results += '</div>';
            document.getElementById('bidirectionalResult').innerHTML = results;
        }

        function testSpecificHours() {
            const testCases = [
                { y: 0, expected: '08:00' },
                { y: 30, expected: '08:30' },
                { y: 300, expected: '18:00' },
                { y: 330, expected: '18:30' },
                { y: 150, expected: '13:00' },
                { y: 180, expected: '13:30' },
                { y: 240, expected: '16:00' },
                { y: 270, expected: '16:30' }
            ];

            let results = '<div class="info"><h4>Test Hores Específiques:</h4>';

            testCases.forEach(testCase => {
                const result = coordinateToTime(testCase.y);
                const isCorrect = result === testCase.expected;

                results += `
                    <div class="${isCorrect ? 'success' : 'error'}">
                        Y=${testCase.y}px → <strong>${result}</strong>
                        (esperat: ${testCase.expected}) ${isCorrect ? '✅' : '❌'}
                    </div>
                `;
            });

            results += '</div>';
            document.getElementById('specificHoursResult').innerHTML = results;
        }

        // Inicialitzar
        updateConfig();
    </script>
</body>
</html>
