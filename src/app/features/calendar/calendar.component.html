<div class="calendar-container">
  <!-- Calendar Header -->
  <div class="calendar-header">
    <div class="calendar-navigation">
      <button class="nav-btn"
              [class.disabled]="!canNavigateToPreviousWeek()"
              [disabled]="!canNavigateToPreviousWeek()"
              (click)="previousWeek()"
              title="Setmana anterior">
        <i class="pi pi-arrow-left"></i>
      </button>
      <button class="nav-btn today-btn" (click)="today()" title="Anar a avui">
        Avui
      </button>
      <button class="nav-btn" (click)="nextWeek()" title="Setmana segÃ¼ent">
        <i class="pi pi-arrow-right"></i>
      </button>
    </div>
    <div class="calendar-title">
      Setmana del {{ formatPopupDate(format(viewDate(), 'yyyy-MM-dd')) }}
    </div>
  </div>

  <!-- Horizontal Weekly View -->
  <div class="calendar-body">
    <div class="horizontal-week-view">
      <!-- Time column -->
      <div class="time-column">
        <div class="time-header">Hora</div>
        @for (time of timeSlots(); track time; let k = $index) {
        <div class="time-slot-label">{{ time }}</div>
        }
      </div>

      <!-- Days columns -->
      @for (day of weekDays(); track day; let i = $index) {
      <div class="day-column" [class.past]="isPastDate(day)">
        <div class="day-header">
          <div class="day-name">{{ getDayName(day) }}</div>
          <div class="day-date">{{ format(day, 'dd/MM') }}</div>
        </div>

        <!-- Time slots for this day -->
        @for (time of timeSlots(); track time; let k = $index) {
        <div class="day-time-slot"
             [class.available]="isTimeSlotAvailable(day, time)"
             [class.booked]="!isTimeSlotAvailable(day, time) && !isLunchBreak(time) && !isPastDate(day) && !isPastTimeSlot(day, time)"
             [class.lunch-break]="isLunchBreak(time)"
             [class.past-date]="isPastDate(day)"
             [class.past-time]="isPastTimeSlot(day, time)"
             [class.selected]="isDaySelected(day) && isTimeSlotSelected(day, time)"
             [class.clickable]="isTimeSlotAvailable(day, time)"
             [class.appointment-slot]="getAppointmentSlotCoverage(day, time) > 0"
             [style.height]="getAppointmentSlotCoverage(day, time) > 0 ? (getAppointmentSlotCoverage(day, time) * 100) + '%' : '100%'"
             [title]="getTimeSlotTooltip(day, time)"
             (click)="selectTimeSlot(day, time)">

          @if (isLunchBreak(time)) {
          <div class="lunch-break-text">
            Pausa
          </div>
          } @else if (getAppointmentSlotCoverage(day, time) > 0) {
          @if (getAppointmentDisplayInfo(day, time); as appointmentInfo) {
          <div class="appointment-info">
            <div class="appointment-title">{{ appointmentInfo.title }}</div>
            @if (appointmentInfo.serviceName) {
            <div class="appointment-service">{{ appointmentInfo.serviceName }}</div>
            }
            <div class="appointment-duration">{{ formatDuration(appointmentInfo.duration) }}</div>
          </div>
          }
          } @else if (isPastDate(day)) {
          <!-- No text for past dates - just visual styling -->
          } @else if (isPastTimeSlot(day, time)) {
          <!-- No text for past time slots - just visual styling -->
          } @else if (!isTimeSlotAvailable(day, time)) {
          <div class="booked-event">
            Ocupat
          </div>
          }
        </div>
        }
      </div>
      }
    </div>
  </div>

  <!-- Appointment Detail Popup -->
  <pelu-appointment-detail-popup
    [open]="showDetailPopup()"
    [appointment]="selectedAppointment()"
    (closed)="onAppointmentDetailPopupClosed()">
  </pelu-appointment-detail-popup>
</div>
