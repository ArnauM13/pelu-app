<div class="calendar-container">
  <!-- Calendar Header -->
  <div class="calendar-header">
    <div class="calendar-navigation">
      <button class="nav-btn" (click)="previousWeek()">
        <i class="pi pi-chevron-left"></i>
      </button>
      <button class="nav-btn today-btn" (click)="today()">
        Avui
      </button>
      <button class="nav-btn" (click)="nextWeek()">
        <i class="pi pi-chevron-right"></i>
      </button>
    </div>
    <div class="calendar-title">
      Setmana del {{ formatPopupDate(format(viewDate(), 'yyyy-MM-dd')) }}
    </div>
  </div>

  <!-- Weekly List View -->
  <div class="calendar-body">
    <div class="week-list">
      @for (day of weekDays(); track day) {
      <div class="day-card" [class.past]="isPastDate(day)" [class.selected]="isDaySelected(day)" (click)="selectDay(day)">
        <div class="day-header">
          <div class="day-name">{{ getDayName(day) }}</div>
          <div class="day-date">{{ format(day, 'dd/MM') }}</div>
        </div>

        <div class="day-events">
          @for (event of getEventsForDay(day); track event.start) {
          <div class="event-item">
            <span class="event-time">{{ getEventTime(event.start) }}</span>
            <span class="event-title">{{ event.title }}</span>
          </div>
          }
        </div>

        <!-- Show time slots when day is selected -->
        @if (isDaySelected(day)) {
        <div class="day-time-slots">
          <div class="time-slots-header">
            <h4>Selecciona una hora:</h4>
          </div>
          <div class="time-slots-grid">
            @for (time of timeSlots(); track time) {
            <button class="time-slot-btn"
                    [class.available]="isTimeSlotAvailable(day, time)"
                    [class.booked]="!isTimeSlotAvailable(day, time)"
                    [disabled]="!isTimeSlotAvailable(day, time)"
                    (click)="selectTimeSlot(day, time)">
              {{ time }}
            </button>
            }
          </div>
        </div>
        }
      </div>
      }
    </div>
  </div>
</div>
