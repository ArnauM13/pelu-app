<div
  class="pelu-appointments-page container"
  style="margin-top: 1rem; view-transition-name: appointments-container"
>
  <!-- Full Screen Loading State -->
  @if (loading()) {
    <pelu-loading-state [config]="loadingConfig"> </pelu-loading-state>
  }

  <!-- Main Content -->
  @if (!loading()) {
    <!-- Statistics Cards -->
    <pelu-appointments-stats
      [stats]="appointmentStats()"
      (onQuickFilterChange)="setQuickFilter($event)"
    >
    </pelu-appointments-stats>

    <!-- Next Appointment -->
    <pelu-next-appointment
      [bookings]="appointments()"
      (onViewDetail)="viewAppointmentDetail($event)"
    >
    </pelu-next-appointment>

    <!-- Inline Filters -->
    <pelu-filters-inline
      [filterDate]="filterDate"
      [filterClient]="filterClient"
      [filterService]="filterService"
      [onDateChange]="setFilterDate"
      [onClientChange]="setFilterClient"
      [onServiceChange]="setFilterService"
      [onReset]="clearAllFilters"
    >
    </pelu-filters-inline>

    <!-- View Mode Toggle (main action - right side) -->
    <pelu-appointments-view-controls
      [viewButtons]="viewButtons()"
      (onViewModeChange)="setViewMode($event)"
    >
    </pelu-appointments-view-controls>

    <!-- Calendar View -->
    @if (viewMode() === 'calendar') {
      <div class="calendar-layout">
        <!-- Calendar Component -->
        <div class="calendar-section">
          <pelu-card variant="large" style="view-transition-name: calendar-view">
            <div class="card-header">
              <h3>ðŸ“… {{ 'COMMON.APPOINTMENTS_CALENDAR' | translate }}</h3>
              <p class="calendar-subtitle">{{ 'COMMON.VIEW_APPOINTMENTS' | translate }}</p>
            </div>

            <div class="calendar-container">
              @defer {
                <pelu-calendar-component
                  [events]="calendarEvents()"
                  [mini]="false"
                  (editAppointment)="editAppointment($event)"
                  (deleteAppointment)="deleteAppointment($event)"
                >
                </pelu-calendar-component>
              } @placeholder {
                <div class="calendar-placeholder">
                  <pelu-loading-state [config]="loadingConfig"> </pelu-loading-state>
                </div>
              }
            </div>
          </pelu-card>
        </div>
      </div>
    }

    <!-- Appointments List View -->
    @if (viewMode() === 'list') {
      <pelu-appointments-list
        [bookings]="filteredAppointments()"
        [hasActiveFilters]="hasActiveFilters()"
        (viewBooking)="viewAppointmentDetail($event)"
        (editBooking)="editBookingFromList($event)"
        (deleteBooking)="deleteBookingFromList($event)"
        (clearFilters)="clearAllFilters()"
      >
      </pelu-appointments-list>
    }
  }
</div>
