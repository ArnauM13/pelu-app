<div class="admin-settings-page single-screen">
  @if (loading()) {
    <pelu-loading-state [config]="{ message: 'COMMON.STATUS.LOADING', spinnerSize: 'large', showMessage: true, fullHeight: true, overlay: true }"></pelu-loading-state>
  }

  <div class="settings-card">
    <div class="settings-header">
      <div class="header-content">
        <div class="header-text">
          <h1>{{ 'ADMIN.SETTINGS_PAGE.TITLE' | translate }}</h1>
          <p>{{ 'ADMIN.SETTINGS_PAGE.SUBTITLE' | translate }}</p>
        </div>
        <div class="header-actions">
          <pelu-button
            type="button"
            [label]="isEditMode() ? 'COMMON.ACTIONS.CANCEL' : 'COMMON.ACTIONS.EDIT' | translate"
            [icon]="isEditMode() ? 'pi pi-times' : 'pi pi-pencil'"
            [severity]="isEditMode() ? 'secondary' : 'primary'"
            (clicked)="isEditMode() ? cancelEditMode() : setEditMode()"
          >
          </pelu-button>
        </div>
      </div>
    </div>

    <!-- Settings Content -->
    <div class="settings-content">
      <form [formGroup]="settingsForm" (ngSubmit)="saveSettings()">
        <div class="settings-grid">
          <!-- Column 1: Business Information -->
          <div class="settings-column">
            <h3 class="column-title">{{ 'ADMIN.SETTINGS_PAGE.BUSINESS_INFO' | translate }}</h3>

            <!-- Business Name -->
            <div class="settings-group">
              <pelu-input-text
                [label]="'ADMIN.SETTINGS_PAGE.BUSINESS_NAME'"
                [placeholder]="'ADMIN.SETTINGS_PAGE.BUSINESS_NAME'"
                [readonly]="!isEditMode()"
                [value]="settingsForm.get('businessName')?.value"
                (valueChange)="settingsForm.get('businessName')?.setValue($event)"
              >
              </pelu-input-text>
            </div>

            <!-- Business Hours Start -->
            <div class="settings-group">
              <pelu-input-date
                label='ADMIN.SETTINGS_PAGE.BUSINESS_HOURS_START'
                placeholder='08:00'
                [timeOnly]="true"
                hourFormat='24'
                dateFormat='HH:mm'
                [readonly]="!isEditMode()"
                [enabled]="isEditMode()"
                [value]="settingsForm.get('businessHoursStart')?.value"
                (valueChange)="settingsForm.get('businessHoursStart')?.setValue($event)"
              >
              </pelu-input-date>
            </div>

            <!-- Business Hours End -->
            <div class="settings-group">
              <pelu-input-date
                [label]="'ADMIN.SETTINGS_PAGE.BUSINESS_HOURS_END'"
                [placeholder]="'20:00'"
                [timeOnly]="true"
                [hourFormat]="'24'"
                [dateFormat]="'HH:mm'"
                [readonly]="!isEditMode()"
                [enabled]="isEditMode()"
                [value]="settingsForm.get('businessHoursEnd')?.value"
                (valueChange)="settingsForm.get('businessHoursEnd')?.setValue($event)"
              >
              </pelu-input-date>
            </div>

            <!-- Lunch Break Start -->
            <div class="settings-group">
              <pelu-input-date
                [label]="'ADMIN.SETTINGS_PAGE.LUNCH_BREAK_START'"
                [placeholder]="'13:00'"
                [timeOnly]="true"
                [hourFormat]="'24'"
                [dateFormat]="'HH:mm'"
                [readonly]="!isEditMode()"
                [enabled]="isEditMode()"
                [value]="settingsForm.get('lunchBreakStart')?.value"
                (valueChange)="settingsForm.get('lunchBreakStart')?.setValue($event)"
              >
              </pelu-input-date>
            </div>

            <!-- Lunch Break End -->
            <div class="settings-group">
              <pelu-input-date
                [label]="'ADMIN.SETTINGS_PAGE.LUNCH_BREAK_END'"
                [placeholder]="'14:00'"
                [timeOnly]="true"
                [hourFormat]="'24'"
                [dateFormat]="'HH:mm'"
                [readonly]="!isEditMode()"
                [enabled]="isEditMode()"
                [value]="settingsForm.get('lunchBreakEnd')?.value"
                (valueChange)="settingsForm.get('lunchBreakEnd')?.setValue($event)"
              >
              </pelu-input-date>
            </div>

                    <!-- Working Days -->
        <div class="settings-group">
          <pelu-input-multiselect
            [label]="'ADMIN.SETTINGS_PAGE.WORKING_DAYS'"
            [placeholder]="'ADMIN.SETTINGS_PAGE.WORKING_DAYS_PLACEHOLDER'"
            [options]="workingDaysOptions"
            [showClear]="true"
            [readonly]="!isEditMode()"
            [value]="settingsForm.get('workingDays')?.value || []"
            (valueChange)="settingsForm.get('workingDays')?.setValue($event)"
          >
            <!-- Custom template for translated day labels -->
            <ng-template #item let-option>
              <span>{{ option.label | translate }}</span>
            </ng-template>
          </pelu-input-multiselect>
        </div>
          </div>

          <!-- Column 2: Appointment Settings -->
          <div class="settings-column">
            <h3 class="column-title">{{ 'ADMIN.SETTINGS_PAGE.APPOINTMENT_SETTINGS' | translate }}</h3>

            <!-- Appointment Duration -->
            <div class="settings-group">
              <pelu-input-number
                [label]="'ADMIN.SETTINGS_PAGE.APPOINTMENT_DURATION'"
                [min]="15"
                [max]="480"
                [step]="15"
                [suffix]="' min'"
                [readonly]="!isEditMode()"
                [value]="settingsForm.get('appointmentDuration')?.value"
                (valueChange)="settingsForm.get('appointmentDuration')?.setValue($event)"
              >
              </pelu-input-number>
            </div>

            <!-- Max Appointments Per User -->
            <div class="settings-group">
              <pelu-input-number
                [label]="'ADMIN.SETTINGS_PAGE.MAX_APPOINTMENTS_PER_USER'"
                [min]="1"
                [max]="10"
                [helpText]="'ADMIN.SETTINGS_PAGE.MAX_APPOINTMENTS_PER_USER_HELP'"
                [readonly]="!isEditMode()"
                [value]="settingsForm.get('maxAppointmentsPerUser')?.value"
                (valueChange)="settingsForm.get('maxAppointmentsPerUser')?.setValue($event)"
              >
              </pelu-input-number>
            </div>

            <!-- Auto Confirm -->
            <div class="settings-group">
              <pelu-input-checkbox
                [label]="'ADMIN.SETTINGS_PAGE.AUTO_CONFIRM'"
                [readonly]="!isEditMode()"
                [value]="settingsForm.get('autoConfirm')?.value"
                (valueChange)="settingsForm.get('autoConfirm')?.setValue($event)"
              >
              </pelu-input-checkbox>
            </div>

            <!-- Notifications -->
            <div class="settings-group">
              <pelu-input-checkbox
                [label]="'ADMIN.SETTINGS_PAGE.SEND_NOTIFICATIONS'"
                [readonly]="!isEditMode()"
                [value]="settingsForm.get('sendNotifications')?.value"
                (valueChange)="settingsForm.get('sendNotifications')?.setValue($event)"
              >
              </pelu-input-checkbox>
            </div>

            <!-- Prevent Cancellation -->
            <div class="settings-group">
              <pelu-input-checkbox
                [label]="'ADMIN.SETTINGS_PAGE.PREVENT_CANCELLATION'"
                [readonly]="!isEditMode()"
                [value]="settingsForm.get('preventCancellation')?.value"
                (valueChange)="settingsForm.get('preventCancellation')?.setValue($event)"
              >
              </pelu-input-checkbox>
            </div>

            <!-- Cancellation Time Limit -->
            <div class="settings-group" *ngIf="settingsForm.get('preventCancellation')?.value">
              <pelu-input-number
                [label]="'ADMIN.SETTINGS_PAGE.CANCELLATION_TIME_LIMIT'"
                [min]="1"
                [max]="168"
                [suffix]="' h'"
                [helpText]="'ADMIN.SETTINGS_PAGE.CANCELLATION_TIME_LIMIT_HELP'"
                [readonly]="!isEditMode()"
                [value]="settingsForm.get('cancellationTimeLimit')?.value"
                (valueChange)="settingsForm.get('cancellationTimeLimit')?.setValue($event)"
              >
              </pelu-input-number>
            </div>
          </div>

          <!-- Column 3: Booking & System Settings -->
          <div class="settings-column">
            <h3 class="column-title">{{ 'ADMIN.SETTINGS_PAGE.BOOKING_SYSTEM_SETTINGS' | translate }}</h3>

            <!-- Booking Advance Days -->
            <div class="settings-group">
              <pelu-input-number
                [label]="'ADMIN.SETTINGS_PAGE.BOOKING_ADVANCE_DAYS'"
                [min]="1"
                [max]="365"
                [suffix]="' dies'"
                [helpText]="'ADMIN.SETTINGS_PAGE.BOOKING_ADVANCE_DAYS_HELP'"
                [readonly]="!isEditMode()"
                [value]="settingsForm.get('bookingAdvanceDays')?.value"
                (valueChange)="settingsForm.get('bookingAdvanceDays')?.setValue($event)"
              >
              </pelu-input-number>
            </div>

            <!-- Booking Advance Time -->
            <div class="settings-group">
              <pelu-input-number
                [label]="'ADMIN.SETTINGS_PAGE.BOOKING_ADVANCE_TIME'"
                [min]="15"
                [max]="1440"
                [step]="15"
                [suffix]="' min'"
                [helpText]="'ADMIN.SETTINGS_PAGE.BOOKING_ADVANCE_TIME_HELP'"
                [readonly]="!isEditMode()"
                [value]="settingsForm.get('bookingAdvanceTime')?.value"
                (valueChange)="settingsForm.get('bookingAdvanceTime')?.setValue($event)"
              >
              </pelu-input-number>
            </div>

            <!-- Language -->
            <div class="settings-group">
              <pelu-input-select
                [label]="'ADMIN.SETTINGS_PAGE.DEFAULT_LANGUAGE'"
                [placeholder]="'ADMIN.SETTINGS_PAGE.DEFAULT_LANGUAGE'"
                [options]="languageOptions"
                [showClear]="true"
                [readonly]="!isEditMode()"
                [value]="settingsForm.get('defaultLanguage')?.value"
                (valueChange)="settingsForm.get('defaultLanguage')?.setValue($event)"
              >
              </pelu-input-select>
            </div>

            <!-- Currency -->
            <div class="settings-group">
              <pelu-input-select
                [label]="'ADMIN.SETTINGS_PAGE.CURRENCY'"
                [placeholder]="'ADMIN.SETTINGS_PAGE.CURRENCY'"
                [options]="currencyOptions"
                [showClear]="true"
                [helpText]="'ADMIN.SETTINGS_PAGE.CURRENCY_HELP'"
                [readonly]="!isEditMode()"
                [value]="settingsForm.get('currency')?.value"
                (valueChange)="settingsForm.get('currency')?.setValue($event)"
              >
              </pelu-input-select>
            </div>
          </div>
        </div>

        <!-- Save Actions (only visible in edit mode) -->
        <div class="settings-actions" *ngIf="isEditMode()">
          <pelu-button
            type="submit"
            [label]="'ADMIN.SETTINGS_PAGE.SAVE_SETTINGS' | translate"
            [loading]="saving()"
            [disabled]="saving()"
            icon="pi pi-save"
            severity="primary"
          >
          </pelu-button>
          <pelu-button
            type="button"
            severity="secondary"
            [label]="'ADMIN.SETTINGS_PAGE.RESET_DEFAULTS' | translate"
            [disabled]="saving()"
            icon="pi pi-refresh"
            (clicked)="resetToDefaults()"
          >
          </pelu-button>
        </div>
      </form>
    </div>
  </div>
</div>
