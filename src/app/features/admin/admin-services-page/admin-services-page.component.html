<div class="admin-services-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>üõ†Ô∏è {{ 'ADMIN.SERVICES.TITLE' | translate }}</h1>
      <p>{{ 'ADMIN.SERVICES.SUBTITLE' | translate }}</p>
    </div>
    <div class="header-actions">
      <button
        pButton
        type="button"
        label="{{ 'ADMIN.SERVICES.ADD_SERVICE' | translate }}"
        icon="pi pi-plus"
        class="p-button-primary"
        (click)="showCreateService()">
      </button>
            <button
        pButton
        type="button"
        label="{{ 'ADMIN.SERVICES.REFRESH' | translate }}"
        icon="pi pi-refresh"
        class="p-button-secondary"
        (click)="refreshServices()">
      </button>
      <button
        pButton
        type="button"
        label="{{ 'ADMIN.SERVICES.MIGRATE_SERVICES' | translate }}"
        icon="pi pi-download"
        class="p-button-warning"
        (click)="migrateServices()">
      </button>
      <button
        pButton
        type="button"
        label="{{ 'ADMIN.SERVICES.CREATE_SAMPLE_SERVICES' | translate }}"
        icon="pi pi-plus-circle"
        class="p-button-info"
        (click)="createSampleServices()">
      </button>
      <button
        pButton
        type="button"
        label="{{ 'ADMIN.SERVICES.CATEGORIES.MANAGE_CATEGORIES' | translate }}"
        icon="pi pi-tags"
        class="p-button-success"
        (click)="showCreateCategory()">
      </button>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <pelu-loading-state [config]="loadingConfig"></pelu-loading-state>
  }

  <!-- Services Content -->
  @if (!isLoading()) {
    <div class="services-content">
      <!-- Services by Category -->
      @for (category of servicesByCategory(); track category.id) {
        <div class="service-category">
          <div class="category-header">
            <div class="category-info">
              <span class="category-icon">{{ getCategoryIcon(category.id) }}</span>
              <h2>{{ getCategoryName(category.id) }}</h2>
              <span class="service-count">({{ category.services.length }})</span>
            </div>
          </div>

          <div class="services-grid">
            @for (service of category.services; track service.id) {
              <div class="service-card">
                <div class="service-header">
                  <div class="service-icon">{{ service.icon }}</div>
                  <div class="service-info">
                    <h3>{{ service.name }}</h3>
                    @if (service.popular) {
                      <span class="popular-badge">‚≠ê&nbsp;{{ 'ADMIN.SERVICES.POPULAR' | translate }}</span>
                    }
                  </div>
                  <div class="service-actions">
                    <button
                      class="btn btn-secondary btn-sm"
                      [title]="'ADMIN.SERVICES.EDIT_SERVICE' | translate"
                      (click)="showEditService(service)">
                      ‚úèÔ∏è {{ 'COMMON.ACTIONS.EDIT' | translate }}
                    </button>
                    <button
                      class="btn btn-danger btn-sm"
                      [title]="'COMMON.ACTIONS.DELETE' | translate"
                      (click)="deleteService(service)">
                      üóëÔ∏è {{ 'COMMON.ACTIONS.DELETE' | translate }}
                    </button>
                  </div>
                </div>
                <div class="service-details">
                  <p class="service-description">{{ service.description }}</p>
                  <div class="service-meta">
                    <div class="meta-item">
                      <span class="meta-label">‚è±Ô∏è&nbsp;{{ 'ADMIN.SERVICES.DURATION_MINUTES' | translate }}:</span>
                      <span class="meta-value">{{ service.duration }} {{ 'COMMON.UNITS.MINUTES' | translate }}</span>
                    </div>
                    <div class="meta-item">
                      <span class="meta-label">üí∞&nbsp;{{ 'ADMIN.SERVICES.PRICE_EURO' | translate }}:</span>
                      <span class="meta-value">{{ service.price | currency }}</span>
                    </div>
                    <div class="meta-item">
                      <span class="meta-label">üìÇ&nbsp;{{ 'ADMIN.SERVICES.CATEGORY' | translate }}:</span>
                      <span class="meta-value">{{ getCategoryName(service.category) }}</span>
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>

          @if (category.services.length === 0) {
            <div class="empty-category">
              <p>{{ 'ADMIN.SERVICES.NO_SERVICES_IN_CATEGORY' | translate }}</p>
            </div>
          }
        </div>
      }
    </div>
  }

  <!-- Create Service Dialog -->
  @if (showCreateDialog()) {
    <div class="service-dialog-overlay" (click)="cancelDialog()">
      <div class="service-dialog" (click)="$event.stopPropagation()">
        <div class="popup-header">
          <h2>{{ 'ADMIN.SERVICES.CREATE_SERVICE' | translate }}</h2>
          <button class="close-button" (click)="cancelDialog()">‚úï</button>
        </div>

        <div class="popup-content">
          <div class="service-form">
            <div class="form-section">
              <h3>{{ 'COMMON.BASIC_INFORMATION' | translate }}</h3>
              <div class="form-grid">
                <div class="form-field">
                  <label for="serviceName">{{ 'COMMON.NAME' | translate }} *</label>
                  <input
                    pInputText
                    id="serviceName"
                    [(ngModel)]="formData().name"
                    placeholder="{{ 'ADMIN.SERVICES.NAME_PLACEHOLDER' | translate }}"
                    class="w-full">
                </div>
                <div class="form-field">
                  <label for="serviceDescription">{{ 'COMMON.DESCRIPTION' | translate }} *</label>
                  <textarea
                    pInputText
                    id="serviceDescription"
                    [(ngModel)]="formData().description"
                    placeholder="{{ 'ADMIN.SERVICES.DESCRIPTION_PLACEHOLDER' | translate }}"
                    rows="3"
                    class="w-full">
                  </textarea>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h3>{{ 'COMMON.CATEGORY_AND_ICON' | translate }}</h3>
              <div class="form-grid">
                <div class="form-field">
                  <label for="serviceCategory">{{ 'COMMON.CATEGORY' | translate }} *</label>
                  <p-dropdown
                    id="serviceCategory"
                    [(ngModel)]="formData().category"
                    [options]="categoryOptions()"
                    optionLabel="label"
                    optionValue="value"
                    placeholder="{{ 'ADMIN.SERVICES.SELECT_CATEGORY' | translate }}"
                    class="w-full">
                    <ng-template pTemplate="selectedItem" let-option>
                      <span>{{ option.icon }}&nbsp;{{ 'SERVICES.CATEGORIES.' + option.value.toUpperCase() | translate }}</span>
                    </ng-template>
                    <ng-template pTemplate="item" let-option>
                      <span>{{ option.icon }}&nbsp;{{ 'SERVICES.CATEGORIES.' + option.value.toUpperCase() | translate }}</span>
                    </ng-template>
                  </p-dropdown>
                </div>
                <div class="form-field">
                  <label for="serviceIcon">{{ 'ADMIN.SERVICES.ICON' | translate }}</label>
                  <p-dropdown
                    id="serviceIcon"
                    [(ngModel)]="formData().icon"
                    [options]="iconOptions"
                    optionLabel="label"
                    optionValue="value"
                    placeholder="{{ 'ADMIN.SERVICES.SELECT_ICON' | translate }}"
                    class="w-full">
                    <ng-template pTemplate="selectedItem" let-option>
                      <span>{{ option.value }}&nbsp;{{ option.label }}</span>
                    </ng-template>
                    <ng-template pTemplate="item" let-option>
                      <span>{{ option.value }}&nbsp;{{ option.label }}</span>
                    </ng-template>
                  </p-dropdown>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h3>{{ 'COMMON.PRICING_AND_DURATION' | translate }}</h3>
              <div class="form-grid">
                <div class="form-field">
                  <label for="servicePrice">{{ 'ADMIN.SERVICES.PRICE_EURO' | translate }} *</label>
                  <p-inputNumber
                    id="servicePrice"
                    [(ngModel)]="formData().price"
                    [min]="0"
                    [max]="1000"
                    [step]="0.01"
                    placeholder="0.00"
                    class="w-full">
                  </p-inputNumber>
                </div>
                <div class="form-field">
                  <label for="serviceDuration">{{ 'ADMIN.SERVICES.DURATION_MINUTES' | translate }} *</label>
                  <p-inputNumber
                    id="serviceDuration"
                    [(ngModel)]="formData().duration"
                    [min]="5"
                    [max]="480"
                    [step]="5"
                    placeholder="30"
                    class="w-full">
                  </p-inputNumber>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h3>{{ 'COMMON.OPTIONS' | translate }}</h3>
              <div class="form-field">
                <p-checkbox
                  id="servicePopular"
                  [(ngModel)]="formData().popular"
                  [binary]="true">
                </p-checkbox>
                <label for="servicePopular" class="checkbox-label">
                  {{ 'ADMIN.SERVICES.MARK_AS_POPULAR' | translate }}
                </label>
              </div>
            </div>
          </div>
        </div>

        <div class="popup-actions">
          <button
            class="btn btn-secondary"
            (click)="cancelDialog()">
            {{ 'COMMON.CANCEL' | translate }}
          </button>
          <button
            class="btn btn-primary"
            (click)="createService()">
            ‚úèÔ∏è {{ 'ADMIN.SERVICES.CREATE_SERVICE' | translate }}
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Edit Service Dialog -->
  @if (showEditDialog()) {
    <div class="service-dialog-overlay" (click)="cancelDialog()">
      <div class="service-dialog" (click)="$event.stopPropagation()">
        <div class="popup-header">
          <h2>{{ 'ADMIN.SERVICES.EDIT_SERVICE' | translate }}</h2>
          <button class="close-button" (click)="cancelDialog()">‚úï</button>
        </div>

        <div class="popup-content">
          <div class="service-form">
            <div class="form-section">
              <h3>{{ 'COMMON.BASIC_INFORMATION' | translate }}</h3>
              <div class="form-grid">
                <div class="form-field">
                  <label for="editServiceName">{{ 'COMMON.NAME' | translate }} *</label>
                  <input
                    pInputText
                    id="editServiceName"
                    [(ngModel)]="formData().name"
                    placeholder="{{ 'ADMIN.SERVICES.NAME_PLACEHOLDER' | translate }}"
                    class="w-full">
                </div>
                <div class="form-field">
                  <label for="editServiceDescription">{{ 'COMMON.DESCRIPTION' | translate }} *</label>
                  <textarea
                    pInputText
                    id="editServiceDescription"
                    [(ngModel)]="formData().description"
                    placeholder="{{ 'ADMIN.SERVICES.DESCRIPTION_PLACEHOLDER' | translate }}"
                    rows="3"
                    class="w-full">
                  </textarea>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h3>{{ 'COMMON.CATEGORY_AND_ICON' | translate }}</h3>
              <div class="form-grid">
                <div class="form-field">
                  <label for="editServiceCategory">{{ 'COMMON.CATEGORY' | translate }} *</label>
                  <p-dropdown
                    id="editServiceCategory"
                    [(ngModel)]="formData().category"
                    [options]="categoryOptions()"
                    optionLabel="label"
                    optionValue="value"
                    placeholder="{{ 'ADMIN.SERVICES.SELECT_CATEGORY' | translate }}"
                    class="w-full">
                    <ng-template pTemplate="selectedItem" let-option>
                      <span>{{ option.icon }}&nbsp;{{ 'SERVICES.CATEGORIES.' + option.value.toUpperCase() | translate }}</span>
                    </ng-template>
                    <ng-template pTemplate="item" let-option>
                      <span>{{ option.icon }}&nbsp;{{ 'SERVICES.CATEGORIES.' + option.value.toUpperCase() | translate }}</span>
                    </ng-template>
                  </p-dropdown>
                </div>
                <div class="form-field">
                  <label for="editServiceIcon">{{ 'ADMIN.SERVICES.ICON' | translate }}</label>
                  <p-dropdown
                    id="editServiceIcon"
                    [(ngModel)]="formData().icon"
                    [options]="iconOptions"
                    optionLabel="label"
                    optionValue="value"
                    placeholder="{{ 'ADMIN.SERVICES.SELECT_ICON' | translate }}"
                    class="w-full">
                    <ng-template pTemplate="selectedItem" let-option>
                      <span>{{ option.value }}&nbsp;{{ option.label }}</span>
                    </ng-template>
                    <ng-template pTemplate="item" let-option>
                      <span>{{ option.value }}&nbsp;{{ option.label }}</span>
                    </ng-template>
                  </p-dropdown>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h3>{{ 'COMMON.PRICING_AND_DURATION' | translate }}</h3>
              <div class="form-grid">
                <div class="form-field">
                  <label for="editServicePrice">{{ 'ADMIN.SERVICES.PRICE_EURO' | translate }} *</label>
                  <p-inputNumber
                    id="editServicePrice"
                    [(ngModel)]="formData().price"
                    [min]="0"
                    [max]="1000"
                    [step]="0.01"
                    placeholder="0.00"
                    class="w-full">
                  </p-inputNumber>
                </div>
                <div class="form-field">
                  <label for="editServiceDuration">{{ 'ADMIN.SERVICES.DURATION_MINUTES' | translate }} *</label>
                  <p-inputNumber
                    id="editServiceDuration"
                    [(ngModel)]="formData().duration"
                    [min]="5"
                    [max]="480"
                    [step]="5"
                    placeholder="30"
                    class="w-full">
                  </p-inputNumber>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h3>{{ 'COMMON.OPTIONS' | translate }}</h3>
              <div class="form-field">
                <p-checkbox
                  id="editServicePopular"
                  [(ngModel)]="formData().popular"
                  [binary]="true">
                </p-checkbox>
                <label for="editServicePopular" class="checkbox-label">
                  {{ 'ADMIN.SERVICES.MARK_AS_POPULAR' | translate }}
                </label>
              </div>
            </div>
          </div>
        </div>

        <div class="popup-actions">
          <button
            class="btn btn-secondary"
            (click)="cancelDialog()">
            {{ 'COMMON.CANCEL' | translate }}
          </button>
          <button
            class="btn btn-primary"
            (click)="updateService()">
            ‚úèÔ∏è {{ 'ADMIN.SERVICES.EDIT_SERVICE' | translate }}
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Create Category Dialog -->
  @if (showCreateCategoryDialog()) {
    <div class="service-dialog-overlay" (click)="cancelCategoryDialog()">
      <div class="service-dialog" (click)="$event.stopPropagation()">
        <div class="popup-header">
          <h2>{{ 'ADMIN.SERVICES.CATEGORIES.CREATE_CATEGORY' | translate }}</h2>
          <button class="close-button" (click)="cancelCategoryDialog()">‚úï</button>
        </div>

        <div class="popup-content">
          <div class="category-form">
            <div class="form-section">
              <h3>{{ 'COMMON.BASIC_INFORMATION' | translate }}</h3>
              <div class="form-grid">
                <div class="form-field">
                  <label for="categoryName">{{ 'ADMIN.SERVICES.CATEGORIES.CATEGORY_NAME' | translate }} *</label>
                  <input
                    pInputText
                    id="categoryName"
                    [(ngModel)]="categoryFormData().name"
                    placeholder="{{ 'ADMIN.SERVICES.CATEGORIES.CATEGORY_NAME_PLACEHOLDER' | translate }}"
                    class="w-full">
                </div>
                <div class="form-field">
                  <label for="categoryId">{{ 'ADMIN.SERVICES.CATEGORIES.CATEGORY_ID' | translate }} *</label>
                  <input
                    pInputText
                    id="categoryId"
                    [(ngModel)]="categoryFormData().id"
                    placeholder="{{ 'ADMIN.SERVICES.CATEGORIES.CATEGORY_ID_PLACEHOLDER' | translate }}"
                    class="w-full">
                  <small class="form-help">Nom√©s lletres min√∫scules, n√∫meros i guions (ex: mi-categoria)</small>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h3>{{ 'COMMON.ICON_SELECTION' | translate }}</h3>
              <div class="form-field">
                <label for="categoryIcon">{{ 'ADMIN.SERVICES.CATEGORIES.CATEGORY_ICON' | translate }} *</label>
                <p-dropdown
                  id="categoryIcon"
                  [(ngModel)]="categoryFormData().icon"
                  [options]="iconOptions"
                  optionLabel="label"
                  optionValue="value"
                  placeholder="{{ 'ADMIN.SERVICES.CATEGORIES.CATEGORY_ICON_PLACEHOLDER' | translate }}"
                  class="w-full">
                  <ng-template pTemplate="selectedItem" let-option>
                    <span>{{ option.value }}&nbsp;{{ option.label }}</span>
                  </ng-template>
                  <ng-template pTemplate="item" let-option>
                    <span>{{ option.value }}&nbsp;{{ option.label }}</span>
                  </ng-template>
                </p-dropdown>
              </div>
            </div>
          </div>
        </div>

        <div class="popup-actions">
          <button
            class="btn btn-secondary"
            (click)="cancelCategoryDialog()">
            {{ 'COMMON.CANCEL' | translate }}
          </button>
          <button
            class="btn btn-primary"
            (click)="createCategory()">
            ‚úèÔ∏è {{ 'ADMIN.SERVICES.CATEGORIES.CREATE_CATEGORY' | translate }}
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Edit Category Dialog -->
  @if (showEditCategoryDialog()) {
    <div class="service-dialog-overlay" (click)="cancelCategoryDialog()">
      <div class="service-dialog" (click)="$event.stopPropagation()">
        <div class="popup-header">
          <h2>{{ 'ADMIN.SERVICES.CATEGORIES.EDIT_CATEGORY' | translate }}</h2>
          <button class="close-button" (click)="cancelCategoryDialog()">‚úï</button>
        </div>

        <div class="popup-content">
          <div class="category-form">
            <div class="form-section">
              <h3>{{ 'COMMON.BASIC_INFORMATION' | translate }}</h3>
              <div class="form-grid">
                <div class="form-field">
                  <label for="editCategoryName">{{ 'ADMIN.SERVICES.CATEGORIES.CATEGORY_NAME' | translate }} *</label>
                  <input
                    pInputText
                    id="editCategoryName"
                    [(ngModel)]="categoryFormData().name"
                    placeholder="{{ 'ADMIN.SERVICES.CATEGORIES.CATEGORY_NAME_PLACEHOLDER' | translate }}"
                    class="w-full">
                </div>
                <div class="form-field">
                  <label for="editCategoryId">{{ 'ADMIN.SERVICES.CATEGORIES.CATEGORY_ID' | translate }} *</label>
                  <input
                    pInputText
                    id="editCategoryId"
                    [(ngModel)]="categoryFormData().id"
                    placeholder="{{ 'ADMIN.SERVICES.CATEGORIES.CATEGORY_ID_PLACEHOLDER' | translate }}"
                    class="w-full"
                    readonly>
                  <small class="form-help">L'ID de la categoria no es pot modificar</small>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h3>{{ 'COMMON.ICON_SELECTION' | translate }}</h3>
              <div class="form-field">
                <label for="editCategoryIcon">{{ 'ADMIN.SERVICES.CATEGORIES.CATEGORY_ICON' | translate }} *</label>
                <p-dropdown
                  id="editCategoryIcon"
                  [(ngModel)]="categoryFormData().icon"
                  [options]="iconOptions"
                  optionLabel="label"
                  optionValue="value"
                  placeholder="{{ 'ADMIN.SERVICES.CATEGORIES.CATEGORY_ICON_PLACEHOLDER' | translate }}"
                  class="w-full">
                  <ng-template pTemplate="selectedItem" let-option>
                    <span>{{ option.value }}&nbsp;{{ option.label }}</span>
                  </ng-template>
                  <ng-template pTemplate="item" let-option>
                    <span>{{ option.value }}&nbsp;{{ option.label }}</span>
                  </ng-template>
                </p-dropdown>
              </div>
            </div>
          </div>
        </div>

        <div class="popup-actions">
          <button
            class="btn btn-secondary"
            (click)="cancelCategoryDialog()">
            {{ 'COMMON.CANCEL' | translate }}
          </button>
          <button
            class="btn btn-primary"
            (click)="updateCategory()">
            ‚úèÔ∏è {{ 'ADMIN.SERVICES.CATEGORIES.EDIT_CATEGORY' | translate }}
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Alert Popup -->
  <pelu-alert-popup
    [isOpen]="showAlertDialog()"
    [data]="alertData()"
    (confirmed)="onAlertConfirmed()"
    (cancelled)="onAlertCancelled()">
  </pelu-alert-popup>

  <!-- Confirm Dialog -->
  <p-confirmDialog></p-confirmDialog>

  <!-- Toast Messages -->
  <p-toast></p-toast>
</div>
