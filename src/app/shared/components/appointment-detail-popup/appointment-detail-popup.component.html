@if (isOpen()) {
  <div class="appointment-detail-popup-overlay" (click)="onClose()">
    <div class="appointment-detail-popup" (click)="$event.stopPropagation()">
      @if (isLoading()) {
        <div class="loading-container">
          <div class="loading-spinner"></div>
          <p>{{ 'COMMON.LOADING' | translate }}</p>
        </div>
      } @else if (loadError()) {
        <div class="error-container">
          <div class="error-icon">‚ùå</div>
          <h3>{{ 'COMMON.ERROR' | translate }}</h3>
          <p>{{ 'COMMON.ERROR_LOADING_BOOKING' | translate }}</p>
          <button class="btn btn-primary" (click)="onClose()">
            {{ 'COMMON.CLOSE' | translate }}
          </button>
        </div>
      } @else if (currentBooking()) {
        <div class="popup-header">
          <h2>{{ 'COMMON.BOOKING_DETAILS' | translate }}</h2>
          <button class="close-button" (click)="onClose()">‚úï</button>
        </div>

        <div class="popup-content">
          <div class="booking-info">
            <div class="client-section">
              <h3>{{ 'COMMON.CLIENT_INFORMATION' | translate }}</h3>
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">{{ 'COMMON.NAME' | translate }}:</span>
                  <span class="info-value">{{ getClientName(currentBooking()!) }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">{{ 'COMMON.EMAIL' | translate }}:</span>
                  <span class="info-value">{{ getClientEmail(currentBooking()!) }}</span>
                </div>
              </div>
            </div>

            <div class="booking-section">
              <h3>{{ 'COMMON.BOOKING_INFORMATION' | translate }}</h3>
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">{{ 'COMMON.DATE' | translate }}:</span>
                  <span class="info-value">{{ formatDate(currentBooking()!.data || '') }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">{{ 'COMMON.TIME' | translate }}:</span>
                  <span class="info-value">{{ formatTime(currentBooking()!.hora || '') }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">{{ 'COMMON.SERVICE' | translate }}:</span>
                  <span class="info-value">{{ getServiceName(currentBooking()!) }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">{{ 'COMMON.DURATION' | translate }}:</span>
                  <span class="info-value">{{ getDuration(currentBooking()!) }} min</span>
                </div>
                <div class="info-item">
                  <span class="info-label">{{ 'COMMON.PRICE' | translate }}:</span>
                  <span class="info-value">{{ getPrice(currentBooking()!) }}‚Ç¨</span>
                </div>
                <div class="info-item">
                  <span class="info-label">{{ 'COMMON.STATUS' | translate }}:</span>
                  <span class="info-value status-badge" [style.color]="getStatusColor(getStatus(currentBooking()!))">
                    {{ getStatusText(getStatus(currentBooking()!)) }}
                  </span>
                </div>
              </div>
            </div>

            @if (getNotes(currentBooking()!)) {
              <div class="notes-section">
                <h3>{{ 'COMMON.NOTES' | translate }}</h3>
                <div class="notes-content">
                  {{ getNotes(currentBooking()!) }}
                </div>
              </div>
            }
          </div>
        </div>

        <div class="popup-actions">
          @if (!hideViewDetailButton()) {
            <button class="btn btn-secondary" (click)="onViewDetail()">
              üëÅÔ∏è {{ 'COMMON.VIEW_DETAIL' | translate }}
            </button>
          }

          @if (canEdit() && isFuture()) {
            <button class="btn btn-primary" (click)="onEdit()">
              ‚úèÔ∏è {{ 'COMMON.ACTIONS.EDIT' | translate }}
            </button>
          }

          @if (canDelete() && isFuture()) {
            <button class="btn btn-danger" (click)="onDelete()">
              üóëÔ∏è {{ 'COMMON.ACTIONS.DELETE' | translate }}
            </button>
          }


        </div>
      } @else {
        <div class="not-found-container">
          <div class="not-found-icon">üìÖ</div>
          <h3>{{ 'COMMON.BOOKING_NOT_FOUND' | translate }}</h3>
          <p>{{ 'COMMON.BOOKING_NOT_FOUND_MESSAGE' | translate }}</p>
          <button class="btn btn-primary" (click)="onClose()">
            {{ 'COMMON.CLOSE' | translate }}
          </button>
        </div>
      }
    </div>
  </div>
}
