<pelu-popup-dialog
  [isOpen]="isOpen()"
  [config]="popupConfig()"
  (closed)="onClose()"
>
  @if (isLoading()) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>{{ 'COMMON.STATUS.LOADING' | translate }}</p>
    </div>
  } @else if (loadError()) {
    <div class="error-container">
      <div class="error-icon">‚ùå</div>
      <h3>{{ 'COMMON.ERROR' | translate }}</h3>
      <p>{{ 'COMMON.ERROR_LOADING_BOOKING' | translate }}</p>
    </div>
  } @else if (currentBooking()) {
    <div class="booking-info">
      <!-- Client Information Section -->
      <div class="form-section">
        <h3>{{ 'COMMON.CLIENT_INFORMATION' | translate }}</h3>
        <div class="form-grid">
          <div class="form-field">
            <pelu-input-text
              [label]="'COMMON.NAME'"
              [value]="isEditing() ? editName() : getClientName(currentBooking()!)"
              [disabled]="!isEditing()"
              [readonly]="!isEditing()"
              [fluid]="true"
              (valueChange)="isEditing() && editName.set($event)">
            </pelu-input-text>
          </div>

          <div class="form-field">
            <pelu-input-text
              [label]="'COMMON.EMAIL'"
              [value]="isEditing() ? editEmail() : getClientEmail(currentBooking()!)"
              [disabled]="!isEditing()"
              [readonly]="!isEditing()"
              [fluid]="true"
              (valueChange)="isEditing() && editEmail.set($event)">
            </pelu-input-text>
          </div>
        </div>
      </div>

      <!-- Booking Information Section -->
      <div class="form-section">
        <h3>{{ 'COMMON.BOOKING_INFORMATION' | translate }}</h3>
        <div class="form-grid">
          <div class="form-field">
            <pelu-input-date
              [label]="'COMMON.DATE'"
              [value]="isEditing() ? editDate() : (currentBooking()!.data || '')"
              [disabled]="!isEditing()"
              [readonly]="!isEditing()"
              (valueChange)="isEditing() ? editDate.set(($any($event) || '')) : null">
            </pelu-input-date>
          </div>

          <div class="form-field">
            <pelu-input-text
              [label]="'COMMON.HOURS'"
              [value]="isEditing() ? editTime() : (currentBooking()!.hora || '')"
              [disabled]="!isEditing()"
              [readonly]="!isEditing()"
              [fluid]="true"
              (valueChange)="isEditing() && editTime.set($event)">
            </pelu-input-text>
          </div>

          <div class="form-field">
            <pelu-input-text
              [label]="'COMMON.SERVICE'"
              [value]="serviceName()"
              [disabled]="true"
              [readonly]="true"
              [fluid]="true">
            </pelu-input-text>
          </div>

          <div class="form-field">
            <pelu-input-text
              [label]="'COMMON.DURATION'"
              [value]="serviceDuration()"
              [disabled]="true"
              [readonly]="true"
              [fluid]="true">
            </pelu-input-text>
          </div>

          <div class="form-field">
            <pelu-input-text
              [label]="'COMMON.PRICE'"
              [value]="servicePrice()"
              [disabled]="true"
              [readonly]="true"
              [fluid]="true">
            </pelu-input-text>
          </div>
        </div>
      </div>

      <!-- Notes Section -->
      @if (currentBooking()!.notes) {
        <div class="section">
          <h3>{{ 'COMMON.NOTES' | translate }}</h3>
          <div class="form-field">
            <pelu-input-textarea
              [label]="'COMMON.NOTES'"
              [value]="isEditing() ? editNotes() : (currentBooking()!.notes || '')"
              [disabled]="!isEditing()"
              [readonly]="!isEditing()"
              [fluid]="true"
              [rows]="3"
              (valueChange)="isEditing() && editNotes.set($event)">
            </pelu-input-textarea>
          </div>
        </div>
      }
    </div>
  }
</pelu-popup-dialog>

@if (showDeleteConfirm()) {
  <pelu-confirmation-popup
    [isOpen]="true"
    [data]="deleteConfirmData()"
    (confirmed)="onDeleteConfirmed()"
    (cancelled)="onDeleteCancelled()"
  >
  </pelu-confirmation-popup>
}
