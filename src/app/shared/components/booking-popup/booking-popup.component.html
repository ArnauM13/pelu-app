@if (open()) {
<div class="booking-popup-overlay" (click)="onBackdropClick($event)">
  <div class="booking-popup" (click)="$event.stopPropagation()">
    <div class="popup-header">
      <h3>{{ 'COMMON.BOOKING_CONFIRMATION' | translate }}</h3>
      <button class="close-btn" (click)="onClose()">×</button>
    </div>

    <div class="popup-body">
      <!-- Date and Time Selection -->
      <div class="datetime-selection">
        <div class="form-group">
          <label>{{ 'COMMON.DATE' | translate }}:</label>
          <div class="readonly-field">{{ formatDate(bookingDetails().date) }}</div>
        </div>
        <div class="form-group">
          <label>{{ 'COMMON.TIME' | translate }}:</label>
          <div class="readonly-field">{{ bookingDetails().time }}</div>
        </div>
      </div>

      <!-- Service Information (Read-only) -->
      <div class="form-group">
        <label>{{ 'COMMON.SERVICE' | translate }}:</label>
        <div class="readonly-field service-display">
          @if (bookingDetails().service) {
            <div class="service-info-display">
              <div class="service-icon">{{ bookingDetails().service?.icon }}</div>
              <div class="service-details">
                <div class="service-name">{{ bookingDetails().service?.name }}</div>
                <div class="service-meta">
                  <span class="service-duration">{{ formatDuration(bookingDetails().service?.duration || 0) }}</span>
                  <span class="service-price">{{ formatPrice(bookingDetails().service?.price || 0) }}</span>
                </div>
              </div>
            </div>
          } @else {
            <span>-</span>
          }
        </div>
      </div>



      <div class="form-group">
        <label>{{ 'COMMON.CLIENT_NAME' | translate }}:</label>
        <div class="readonly-field">{{ bookingDetails().clientName || '-' }}</div>
      </div>
    </div>

    <div class="popup-footer">
      <button class="btn btn-secondary" (click)="onClose()">{{ 'COMMON.CANCEL' | translate }}</button>
      <button
        class="btn btn-primary"
        (click)="onConfirm()"
        [disabled]="!canConfirm()">
        {{ 'COMMON.CONFIRM_BOOKING' | translate }}
      </button>
    </div>
  </div>
</div>
}

<p-toast key="booking-error-toast" position="top-right" [baseZIndex]="9999" *ngIf="showErrorToast()">
  <ng-template let-message pTemplate="message">
    <div class="p-toast-message-content">
      <div class="p-toast-message-icon">
        <i class="pi pi-times"></i>
      </div>
      <div class="p-toast-message-text">
        <span class="p-toast-summary">Error</span>
        <div class="p-toast-detail">{{ errorMessage() || 'Només es poden seleccionar dies laborables.' }}</div>
      </div>
    </div>
  </ng-template>
</p-toast>
