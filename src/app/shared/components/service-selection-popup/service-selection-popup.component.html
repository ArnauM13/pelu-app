@if (isOpen()) {
  <div class="service-selection-overlay" (click)="onBackdropClick($event)">
    <div class="service-selection-popup" (click)="$event.stopPropagation()">
      <div class="popup-header">
        <h3>‚úÇÔ∏è {{ 'COMMON.SELECTION.SELECT_SERVICE' | translate }}</h3>
        <button class="close-btn" (click)="onCancel()">√ó</button>
      </div>

      <div class="popup-body">
        <!-- Date and Time Summary -->
        <div class="selection-summary">
          <div class="summary-item">
            <span class="summary-label">üìÖ {{ 'COMMON.DATE' | translate }}:</span>
            <span class="summary-value">{{ formatDate(selectionDetailsComputed().date) }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">‚è∞ {{ 'COMMON.HOURS' | translate }}:</span>
            <span class="summary-value">{{ selectionDetailsComputed().time }}</span>
          </div>
        </div>

        <!-- Popular Services Section -->
        @if (popularServices().length > 0) {
          <div class="service-selection-section">
            <h4>‚≠ê {{ 'COMMON.SELECTION.POPULAR_SERVICES' | translate }}</h4>
            <div class="services-grid">
              @for (service of popularServices(); track service.id) {
                <div
                  class="service-card"
                  [class.selected]="selectedService()?.id === service.id"
                  (click)="selectService(service)"
                >
                  <div class="service-header">
                    <div class="service-icon">{{ service.icon }}</div>
                    <div class="service-info">
                      <div class="service-name">{{ getServiceName(service) }}</div>
                      <div class="service-description">{{ formatDuration(service.duration) }}</div>
                    </div>
                    <div class="service-price">{{ formatPrice(service.price) }}</div>
                  </div>
                  <div class="service-details">
                    <div class="service-meta">
                      <div class="service-info-left">
                        <span class="service-duration">
                          ‚è±Ô∏è {{ formatDuration(service.duration) }}
                        </span>
                        <pelu-popular-badge
                          [config]="{
                            size: 'small',
                            variant: 'default',
                            showIcon: true,
                            showText: true,
                            text: 'SERVICES.POPULAR',
                          }"
                        >
                        </pelu-popular-badge>
                      </div>
                      @if (selectedService()?.id === service.id) {
                        <span class="selection-indicator">
                          ‚úÖ {{ 'COMMON.SELECTION.SELECTED' | translate }}
                        </span>
                      }
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        }

        <!-- Other Services Section -->
        @if (otherServices().length > 0) {
          <div class="service-selection-section">
            <h4>{{ 'COMMON.SELECTION.OTHER_SERVICES' | translate }}</h4>
            <div class="services-grid">
              @for (service of otherServices(); track service.id) {
                <div
                  class="service-card"
                  [class.selected]="selectedService()?.id === service.id"
                  (click)="selectService(service)"
                >
                  <div class="service-header">
                    <div class="service-icon">{{ service.icon }}</div>
                    <div class="service-info">
                      <div class="service-name">{{ getServiceName(service) }}</div>
                      <div class="service-description">{{ formatDuration(service.duration) }}</div>
                    </div>
                    <div class="service-price">{{ formatPrice(service.price) }}</div>
                  </div>
                  <div class="service-details">
                    <div class="service-meta">
                      <div class="service-info-left">
                        <span class="service-duration">
                          ‚è±Ô∏è {{ formatDuration(service.duration) }}
                        </span>
                      </div>
                      @if (selectedService()?.id === service.id) {
                        <span class="selection-indicator">
                          ‚úÖ {{ 'COMMON.SELECTION.SELECTED' | translate }}
                        </span>
                      }
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        }
      </div>

      <div class="popup-footer">
        <button class="btn-primary" (click)="onConfirm()" [disabled]="!canConfirm()">
          {{ 'COMMON.ACTIONS.CONTINUE' | translate }}
        </button>
      </div>
    </div>
  </div>
}
